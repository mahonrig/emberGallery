$.ajaxSetup({cache:!1}),window.App=Ember.Application.create(),App.stop=!1,App.deletedGallery=!1,App.ApplicationAdapter=DS.RESTAdapter.extend(),App.CartItemSerializer=DS.LSSerializer.extend(),App.CartItemAdapter=DS.LSAdapter.extend({namespace:"photoworks"}),Ember.LinkView.reopen({action:null,_invoke:function(event){var action=this.get("action");return action?(event.preventDefault(),this.bubbles===!1&&event.stopPropagation(),this.get("controller").send(action,this.get("actionParam")),!1):this._super(event)}}),App.ApplicationController=Ember.ArrayController.extend({totalItems:function(){return this.get("cartItem").get("length")}.property("cartItem.@each"),totalPrice:function(){var cartItems=this.get("cartItem");return cartItems.reduce(function(prevValue,item){return prevValue+item.get("price")},0)}.property("cartItem.@each.price"),assignIndex:function(){this.get("cartItem").map(function(item,index){Ember.set(item,"index",index+1)})}.observes("cartItem.[]","firstObject","lastObject"),admin:window.admin,actions:{clearCart:function(){var cartItems=this.get("cartItem");cartItems.forEach(function(item){item.deleteRecord(),item.save()})},toggleCart:function(){$(".cart").fadeToggle()},hideCart:function(){$(".cart").fadeOut()},acceptTitleChange:function(){this.store.find("site",1).then(function(site){site.get("isDirty")&&(site.save(),console.log("Saved Site"))})},showGalleryLinks:function(){$(".galleries").fadeToggle()}}}),App.SlideshowController=Ember.ArrayController.extend({actions:{goToNextPhoto:function(){var length=this.get("model.length");index=this.get("index");var that=this;$(".currentPhoto").fadeOut(function(){length-1>index?(index++,that.set("index",index)):that.set("index",0),$(this).fadeIn()})},goToPrevPhoto:function(){var length=this.get("model.length");index=this.get("index");var that=this;$(".currentPhoto").fadeOut(function(){index>0?(index--,that.set("index",index)):(index=length-1,that.set("index",index)),$(this).fadeIn()})}},index:0,currentPhoto:function(){{var photos=this.get("model");photos.get("length")}return photos.objectAt(this.get("index"))}.property("model.[]","index"),prevPhoto:function(){var photos=this.get("model");return index=this.get("index"),length=photos.get("length"),photos.objectAt(index?index-1:length-1)}.property("model.[]","index"),nextPhoto:function(){var photos=this.get("model");return index=this.get("index"),length=photos.get("length"),length-2>index?photos.objectAt(index+1):index>=length-2?photos.objectAt(0):void 0}.property("model.[]","index")}),App.CartItemController=Ember.ObjectController.extend({actions:{removeFromCart:function(id){this.store.find("cartItem",id).then(function(item){item.deleteRecord(),item.save()})}},paypalFormItem:function(){var index=this.get("index");return"item_name_"+index}.property("index"),paypalFormAmount:function(){var index=this.get("index");return"amount_"+index}.property("index"),paypalFormTitle:function(){var title=this.get("title"),type=this.get("type"),size=this.get("size");return title+" "+size+" "+type}.property("title","type","size")}),App.GalleryPreviewController=Ember.ObjectController.extend({admin:window.admin,actions:{addPhoto:function(id){var that=this;this.store.find("photo",id).then(function(photo){var photos=that.get("photos");photos.contains(photo)||(console.log("Adding Photo "+id+" to "+that.get("id")),photos.pushObject(photo),that.get("model").save())})},acceptTitleChange:function(){console.log("Accepting"),this.get("model").save()},deleteGallery:function(){App.deletedGallery=!0;var gallery=this.get("model");gallery.deleteRecord(),gallery.save()}}}),App.EachGalleryController=Ember.ObjectController.extend({admin:window.admin,actions:{acceptTitleChange:function(){console.log("Accepting"),this.get("model").save()},deleteGallery:function(){App.deletedGallery=!0;var gallery=this.get("model");gallery.deleteRecord(),gallery.save()}}}),App.GalleriesController=Ember.ArrayController.extend({actions:{removePhotoFromGallery:function(data){var that=this;console.log("Removing photo: "+data.photo_id+" from gallery: "+data.gallery_id),this.store.find("photo",data.photo_id).then(function(photo){that.store.find("gallery",data.gallery_id).then(function(gallery){gallery.get("photos").removeObject(photo),gallery.save()})})},showPhotoShadowBox:function(){$(".photoShadowBox").width($(window).width()),$(".photoShadowBox").height($(window).height()),$(".photoShadowBox").fadeIn(),console.log("showed shadow box")}}}),App.GalleriesPhotoController=Ember.ObjectController.extend({actions:{addToCart:function(){var title=this.get("title"),type=this.get("currentType.type"),size=this.get("currentOption.size"),price=this.get("currentOption.price");if(price){var record=this.store.createRecord("cartItem",{title:title,type:type,size:size,price:price});record.save(),$(".added").fadeIn().delay(500).fadeOut(),console.log("Added item: "+title)}else console.log("Please select a size"),$(".errorSelect").fadeIn().delay(500).fadeOut()},acceptTitleChange:function(){this.get("model").save()},addNewOrderOption:function(){console.log("Adding option");var model=this.get("model");model.get("orderTypes").pushObject(this.get("newType")),model.get("orderOptions").pushObject(this.get("newOption")),model.save()},back:function(){this.transitionToRoute("galleries")}},admin:window.admin,currentType:0,currentOption:0,newType:"",newOption:"",currentOptions:function(){var type=this.get("currentType");if(type)var options=this.get("orderOptions").filterProperty("type",type);else var options=0;return options}.property("orderOptions.@each.type","currentType"),currentPhoto:function(){return this.get("model")}.property("model")}),App.GalleryPhotoController=App.GalleriesPhotoController.extend({actions:{back:function(){this.transitionToRoute("gallery")}}}),App.SlideshowPhotoController=App.GalleriesPhotoController.extend({actions:{back:function(){this.transitionToRoute("/")}}}),App.AdminPhotoController=App.GalleriesPhotoController.extend({actions:{back:function(){this.transitionToRoute("/admin")}}}),App.AdminController=Ember.ArrayController.extend({actions:{submitNewOrderType:function(){var record=this.store.createRecord("orderType",{type:this.get("newOrderType")});record.save(),this.set("newOrderType","")},updateOrderType:function(id){this.store.find("orderType",id).then(function(type){type.save(),console.log("Saving order Type")})},deleteOrderType:function(id){this.store.find("orderType",id).then(function(type){type.deleteRecord(),type.save(),console.log("Deleting order Type")})}},newOrderType:""}),App.OrderController=Ember.ObjectController.extend({actions:{createOrderOption:function(type_id){var that=this;this.store.find("orderType",type_id).then(function(orderType){var newOption=that.store.createRecord("orderOption",{type:orderType,size:that.get("newOrderSize"),price:that.get("newOrderPrice")});newOption.save().then(function(option){console.log(option.get("size")),orderType.get("options").pushObject(option)})})},deleteOrderOption:function(id){var that=this;this.store.find("orderOption",id).then(function(option){option.on("didDelete",this,function(){console.log("Reloading"),that.get("model").reload()}),option.deleteRecord(),option.save()})}},newOrderSize:"",newOrderPrice:0}),App.Site=DS.Model.extend({title:DS.attr("string"),bannerImg:DS.belongsTo("photo"),email:DS.attr("string"),facebook:DS.attr("string"),twitter:DS.attr("string"),tumblr:DS.attr("string"),pinterest:DS.attr("string"),paypal:DS.attr("string"),admin:DS.attr("number")}),App.Gallery=DS.Model.extend({title:DS.attr("string",{defaultValue:"New Gallery"}),description:DS.attr("string",{defaultValue:"Description"}),photos:DS.hasMany("photo",{async:!0})}),App.Page=DS.Model.extend({title:DS.attr("string",{defaultValue:"New Page"}),description:DS.attr("string",{defaultValue:"Description"}),contents:DS.hasMany("block")}),App.Block=DS.Model.extend({type:DS.attr("string"),content:DS.attr("string"),page:DS.belongsTo("page")}),App.Photo=DS.Model.extend({title:DS.attr("string",{defaultValue:"New Photo"}),caption:DS.attr("string",{defaultValue:"Description"}),xlargeFile:DS.attr("string"),largeFile:DS.attr("string"),mediumFile:DS.attr("string"),smallFile:DS.attr("string"),thumbFile:DS.attr("string"),orderTypes:DS.hasMany("orderType",{async:!0}),orderOptions:DS.hasMany("orderOption",{async:!0}),fileLarge:function(){var w=$(window).width();return this.get(w>1024?"xlargeFile":w>768?"largeFile":w>512?"mediumFile":w>256?"smallFile":"thumbFile")}.property("xlargeFile","largeFile","mediumFile","smallFile","thumbFile"),fileMedium:function(){var w=$(window).width();return this.get(w>1024?"largeFile":w>768?"mediumFile":w>512?"smallFile":"thumbFile")}.property("largeFile","mediumFile","smallFile","thumbFile"),fileSmall:function(){var w=$(window).width();return this.get(w>1024?"mediumFile":w>768?"smallFile":"thumbFile")}.property("mediumFile","smallFile","thumbFile"),fileThumb:function(){return this.get("thumbFile")}.property("thumbFile")}),App.OrderType=DS.Model.extend({type:DS.attr("string"),options:DS.hasMany("orderOption",{async:!0})}),App.OrderOption=DS.Model.extend({type:DS.belongsTo("orderType"),size:DS.attr("string"),price:DS.attr("number"),display:function(){var displayed=this.get("size")+": $"+this.get("price");return displayed}.property("size","price")}),App.CartItem=DS.Model.extend({title:DS.attr("string"),type:DS.attr("string"),size:DS.attr("string"),price:DS.attr("number")}),App.Router.map(function(){this.resource("slideshow",{path:"/"},function(){this.route("photo",{path:"photo/:photo_id"})}),this.resource("galleries",function(){this.route("photo",{path:"photo/:photo_id"})}),this.resource("gallery",{path:"/gallery/:gallery_id"},function(){this.route("photo",{path:"photo/:photo_id"})}),this.resource("about"),window.admin&&this.resource("admin",function(){this.route("photo",{path:"photo/:photo_id"})}),this.resource("printDetails"),this.resource("login")}),App.Router.reopen({location:"history"}),App.ApplicationRoute=Ember.Route.extend({setupController:function(controller){controller.set("site",this.store.find("site",1)),controller.set("cartItem",this.store.find("cartItem")),controller.set("admin",window.admin),controller.set("galleries",this.store.find("gallery")),controller.set("photos",this.store.find("photo"))},actions:{removePhoto:function(id){this.store.find("photo",id).then(function(photo){photo.deleteRecord(),photo.save()})},saveSite:function(){this.store.find("site",1).then(function(site){site.save()})}}}),App.SlideshowRoute=Ember.Route.extend({model:function(){return this.store.find("photo")}}),App.AdminRoute=Ember.Route.extend({setupController:function(controller){controller.set("site",this.store.find("site",1)),controller.set("photos",this.store.find("photo")),controller.set("galleries",this.store.find("gallery")),controller.set("orderTypes",this.store.find("orderType"))}}),App.GalleriesRoute=Ember.Route.extend({model:function(){return this.store.find("gallery")},setupController:function(controller,model){controller.set("model",model),controller.set("photos",this.store.find("photo")),controller.set("admin",window.admin),$("title").text("All Galleries")},actions:{willTransition:function(transition){App.stop&&transition.abort()}}}),App.GalleriesPhotoRoute=Ember.Route.extend({model:function(params){return this.store.find("photo",params.photo_id)},setupController:function(controller,model){controller.set("model",model),controller.set("site",this.store.find("site",1)),controller.set("availableTypes",this.store.find("orderType"))}}),App.GalleryPhotoRoute=App.GalleriesPhotoRoute.extend(),App.SlideshowPhotoRoute=App.GalleriesPhotoRoute.extend(),App.AdminPhotoRoute=App.GalleriesPhotoRoute.extend(),App.GalleryRoute=Ember.Route.extend({model:function(params){return this.store.find("gallery",params.gallery_id)},actions:{willTransition:function(transition){App.stop&&transition.abort()}}}),App.PhotoRoute=Ember.Route.extend({model:function(params){return this.store.find("photo",params.photo_id)},setupController:function(controller,model){controller.set("model",model),controller.set("site",this.store.find("site",1)),controller.set("availableTypes",this.store.find("orderType"))},actions:{willTransition:function(transition){App.stop&&transition.abort()}}});var resizeHandler=function(){if($(".galleriesMain").height($(window).height()),$(".galleryPreview").each(function(index){if($(window).width()<512){var pos=124*index;$(this).css("width","128px")}else{var pos=250*index;$(this).css("width","256px")}$(this).css({left:pos,"z-index":100-index})}),$("#photoShadowBox").hasClass("visible")){$("#photoShadowBox").width($(window).width()).height($(window).height());var $w=$(window),wW=$w.width(),wH=$w.height(),wW9=.9*wW,wH9=.9*wH,$that=$(".largePhoto").parent().parent(),width=$that.width(),height=$that.height();if(!(wW>=1280))if(width>height){if($that.width(wW9),$that.height()>wH9){$that.height(wH9);var ratio=$that.height()/height;$that.width(width*ratio)}}else{$that.height(wH9);var ratio=$that.height()/height;$that.width(width*ratio),$that.width()>wW9&&$that.width(wW9)}if(!(wH>=1280)&&$that.height()>wH9){$that.height(wH9);var ratio=$that.height()/height;$that.width(width*ratio)}$that.css("position","absolute"),$that.css("left",(wW-$that.width())/2),$that.css("top",(wH-$that.height())/4)}};App.ApplicationView=Ember.View.extend({willAnimateIn:function(){this.$().hide()},animateIn:function(done){var that=this;imagesLoaded("#app",function(){that.$().fadeIn(done)})},hiddenLinks:!1,didAnimateIn:function(){$(".galleryLinks").width()>.6*$(".banner").width()&&this.set("hiddenLinks",!0)},animateOut:function(done){this.$().fadeOut(done)},didInsertElement:function(){this.$("#app").height($(window).height())}}),App.CartView=Ember.View.extend({templateName:"cart"}),App.CartItemView=Ember.View.extend({animateIn:function(done){this.$().fadeIn(done)},animateOut:function(done){this.$().fadeOut(done)}}),App.GalleriesView=Ember.View.extend({templateName:"galleries",willAnimateIn:function(){this.$().hide(),$(".galleriesMain").height($(window).height()),$(".galleryPreview").each(function(index){if($(window).width()<512){var pos=124*index;$(this).css("width","128px")}else{var pos=250*index;$(this).css("width","256px")}$(this).css({left:pos,"z-index":100-index})})},animateIn:function(done){var that=this;imagesLoaded("#app",function(){$(".photoSmall").hide().each(function(index){$(this).css("z-index",100-index),$(this).css("top",-200*(index+1))}).fadeIn().animate({top:0},1250),that.$().fadeIn(1250,function(){done()})})},didAnimateIn:function(){this.set("resizeHandler",resizeHandler),$(window).bind("resize",this.get("resizeHandler"))},animateOut:function(done){$(".galleryPreview .photoSmall").each(function(index){$(this).animate({top:-200*(index+1)},1250)}),$(window).unbind("resize",this.get("resizeHandler")),this.$().fadeOut(1250,done)},didInsertElement:function(){$("title").text("All Galleries"),$(".photoSmall").click(function(){$(this).addClass("picked"),console.log("picked")})}}),App.AvailablePhotosView=Ember.View.extend({templateName:"availablePhotos",actions:{toggleAllPhotos:function(){$(".availablePhotos").hasClass("visible")?($(".availablePhotos").animate({right:-175},500),$(".availablePhotos").removeClass("visible")):($(".availablePhotos").animate({right:0},500),$(".availablePhotos").addClass("visible"))}}}),App.GalleryView=Ember.View.extend({templateName:"gallery",willAnimateIn:function(){this.$().hide()},animateIn:function(done){var that=this;imagesLoaded(".galleryView",function(){$(".mediumPhoto").hide().each(function(index){$(this).css("z-index",100-index),$(this).css("top",-400*(index+1))}).fadeIn().animate({top:0},750),that.$().fadeIn(750,function(){done()})})},animateOut:function(done){$(".mediumPhoto").each(function(index){$(this).animate({top:-400*(index+1)},750)}),$(window).unbind("resize",this.get("resizeHandler")),this.$().fadeOut(750,done)},didAnimateIn:function(){this.set("resizeHandler",resizeHandler),$(window).bind("resize",this.get("resizeHandler"))},modelChanged:function(){imagesLoaded(".galleryView",function(){$(".mediumPhoto").each(function(index){$(this).css("z-index",100-index)})})}.observes("controller.model"),didInsertElement:function(){var controller=this.get("controller");$("title").text("Viewing Gallery - "+controller.get("model.title"))}}),App.SlideshowView=Ember.View.extend({interval:0,slideshow:!0,willAnimateIn:function(){this.$().hide(),this.$(".currentPhoto").hide(),this.$(".prevPhoto").hide(),this.$(".nextPhoto").hide()},animateIn:function(done){var that=this;imagesLoaded("#app",function(){that.$().fadeIn(done)})},didAnimateIn:function(){var that=this;if(this.get("slideshow")){var interval=setInterval(function(){that.get("controller").send("goToNextPhoto")},3e3);this.set("interval",interval)}this.get("controller.store").find("site",1).then(function(site){$("title").html("Welcome to "+site.get("title"))}),this.set("resizeHandler",resizeHandler),$(window).bind("resize",this.get("resizeHandler"))},animateOut:function(done){var interval=this.get("interval");clearInterval(interval),$(window).unbind("resize",this.get("resizeHandler")),this.$().fadeOut(done)},actions:{pauseSlideShow:function(){if(this.get("slideshow")){console.log("pause");var interval=this.get("interval");clearInterval(interval),this.set("slideshow",!1)}},resumeSlideShow:function(){var that=this;if(!this.get("slideshow")){console.log("resume"),that.get("controller").send("goToNextPhoto");var interval=setInterval(function(){that.get("controller").send("goToNextPhoto")},3e3);this.set("interval",interval),this.set("slideshow",!0)}},prev:function(){if(this.get("slideshow")){console.log("pause");var interval=this.get("interval");clearInterval(interval),this.set("slideshow",!1)}this.get("controller").send("goToPrevPhoto")},next:function(){if(this.get("slideshow")){console.log("pause");var interval=this.get("interval");clearInterval(interval),this.set("slideshow",!1)}this.get("controller").send("goToNextPhoto")}}}),App.GalleriesPhotoView=Ember.View.extend({willAnimateIn:function(){this.$().hide(),$("title").html(this.get("controller.model.title"))},animateIn:function(done){var that=this;$("#photoShadowBox").width($(window).width()).height($(window).height()).fadeIn(function(){$(this).addClass("visible"),imagesLoaded(".largePhoto",function(){var $w=$(window),wW=$w.width(),wH=$w.height(),wW9=.9*wW,wH9=.9*wH,$that=that.$(),width=$that.width(),height=$that.height();if(wW>=1280)$that.width(1280);else if(width>height){if($that.width(wW9),$that.height()>wH9){$that.height(wH9);var ratio=$that.height()/height;$that.width(width*ratio)}}else{$that.height(wH9);var ratio=$that.height()/height;$that.width(width*ratio),$that.width()>wW9&&$that.width(wW9)}if(!(wH>=1280)&&$that.height()>wH9){$that.height(wH9);var ratio=$that.height()/height;$that.width(width*ratio),$that.width()>wW9&&$that.width(wW9)}$that.css("position","relative"),$that.css("top",(wH-$that.height())/4),$that.fadeIn(done)})})},animateOut:function(done){this.$().fadeOut(function(){$("title").html("All Galleries"),$("#photoShadowBox").fadeOut(function(){$(this).removeClass("visible"),done()})})}}),App.GalleryPhotoView=App.GalleriesPhotoView.extend(),App.SlideshowPhotoView=App.GalleriesPhotoView.extend(),App.AdminPhotoView=App.GalleriesPhotoView.extend(),App.LargePhotoView=Ember.View.extend({templateName:"largephoto",actions:{showOrder:function(){$(".order").hasClass("visible")?($(".order").fadeOut(),$(".order").removeClass("visible")):($(".order").fadeIn(),$(".order").addClass("visible"))}}}),App.EditTitleTextView=Ember.TextField.extend({classNames:"editTitle",didInsertElement:function(){this.$().attr("size",1.1*this.$().val().length),this.$().focus()},focusOut:function(){this.get("parentView").set("titleEditing",!1),App.stop=!1,this.get("parentView").get("controller").send("acceptTitleChange")},insertNewline:function(){this.get("parentView").set("titleEditing",!1)},click:function(evt){evt.preventDefault()},keyPress:function(){this.$().attr("size",1.1*this.$().val().length)}}),Ember.Handlebars.helper("edit-title",App.EditTitleTextView),App.EditTitleView=Ember.View.extend({templateName:"editTitle",titleEditing:!1,click:function(event){event.preventDefault()},actions:{editTitle:function(){this.set("titleEditing",!0),App.stop=!0}}}),container=Ember.ContainerView.extend({count:0,observeCount:function(){this.get("count")>0?($(".shadowBox").width($(window).width()),$(".shadowBox").height($(window).height()),$(".shadowBox").fadeIn()):$(".shadowBox").fadeOut(),console.log(this.get("count"))}.observes("count")}),App.NewPhotosContainer=container.create(),App.UploadPhotosView=Ember.View.extend({dragEnter:function(event){event.preventDefault()},dragOver:function(event){event.preventDefault()},drop:function(event){event.preventDefault();for(var files=event.dataTransfer.files,i=0;i<files.length;i++)if(files[i].type.match("image.*")){App.NewPhotosContainer.pushObject(App.NewPhotosView.create({file:files[i]}));var count=App.NewPhotosContainer.get("count");count++,App.NewPhotosContainer.set("count",count)}},doubleClick:function(){$("#uploadInput").click()}}),App.EachGalleryView=Ember.View.extend({animateOut:function(done){this.$().fadeOut(done)}}),App.AboutView=Ember.View.extend({animateIn:function(done){this.$().fadeIn(done)},animateOut:function(done){this.$().fadeOut(done)}}),App.PrintDetailsView=App.AboutView.extend(),App.NewPhotosView=Ember.View.extend({animateIn:function(done){this.$().fadeIn(done)},animateOut:function(done){this.$().fadeOut(done)},templateName:"newPhotoDetails",title:"Untitled",src:"",setsrc:function(){var that=this,reader=new FileReader;reader.readAsDataURL(this.get("file")),reader.onload=function(imgsrc){that.set("src",imgsrc.target.result)}}.observes("file").on("init"),actions:{cancel:function(){var count=App.NewPhotosContainer.get("count");count--,App.NewPhotosContainer.set("count",count),App.NewPhotosContainer.removeObject(this)},submit:function(){var that=this,formData=new FormData;formData.append("file",this.get("file")),formData.append("title",this.get("title")),xhr=new XMLHttpRequest,xhr.open("POST","/photos/new"),xhr.upload.onprogress=function(event){if(event.lengthComputable){var complete=event.loaded/event.total*100|0;that.$("progress").value=complete}},xhr.onload=function(){var response=JSON.parse(xhr.responseText);console.log(response.id),App.Photo.store.push("photo",{id:response.id,title:response.title,largeFile:response.largeFile,mediumFile:response.mediumFile,smallFile:response.smallFile,thumbFile:response.thumbFile});var count=App.NewPhotosContainer.get("count");count--,App.NewPhotosContainer.set("count",count),App.NewPhotosContainer.removeObject(that)},xhr.send(formData)}}}),App.addedGallery=!1,App.NewGalleryView=Ember.View.extend({templateName:"newGallery",title:"New Gallery",actions:{submit:function(){console.log("Submitted "+this.get("title"));var that=this,formData=new FormData;formData.append("title",this.get("title")),xhr=new XMLHttpRequest,xhr.open("POST","/gallery/new"),xhr.onload=function(){console.log("Success (maybe)"),that.set("title",""),that.$(".added").fadeIn().delay(500).fadeOut();var response=JSON.parse(xhr.responseText);App.addedGallery=!0,App.Gallery.store.push("gallery",{id:response.id,title:response.title})},xhr.send(formData)}}}),App.DroppablePhotoView=Ember.View.extend({dragStart:function(event){window.admin&&(event.dataTransfer.setData("photo_id",event.target.id),event.dataTransfer.setData("gallery_id",event.target.getAttribute("data-gallery")),$(".removePhoto").slideDown())},dragEnd:function(){$(".removePhoto").slideUp()}}),App.Dropped=!1,App.AddPhotoView=Ember.View.extend({willAnimateIn:function(){App.addedGallery&&this.$().hide()},animateIn:function(done){App.addedGallery?(App.addedGallery=!1,$(".galleryPreview").each(function(index){var pos=250*index;$(this).css("left",pos),$(this).css("z-index",100-index)}),this.$().fadeIn(done)):done()},animateOut:function(done){App.deletedGallery&&(App.deletedGallery=!1,this.$().fadeOut(done))},dragEnter:function(event){event.preventDefault()},dragOver:function(event){event.preventDefault()},drop:function(event){if(window.admin){event.preventDefault();var data=event.dataTransfer.getData("photo_id");this.get("controller").send("addPhoto",data),App.Dropped=!0}}}),App.PhotoSmallView=Ember.View.extend({willAnimateIn:function(){App.Dropped&&this.$(".photoSmall").hide()},animateIn:function(done){App.Dropped&&(App.Dropped=!1,this.$().parent().find(".photoSmall").each(function(index){$(this).css("z-index",100-index)}),this.$(".photoSmall").css("top","-300px").fadeIn(),this.$(".photoSmall").animate({top:0},500,done))},animateOut:function(done){App.Dropped&&(this.$().fadeOut(done),0==App.Dropped)},mouseEnter:function(event){$(event.target).animate({top:"5px"},250)},mouseLeave:function(event){$(event.target).animate({top:"0"},250)}}),App.RemovePhotoView=Ember.View.extend({dragEnter:function(event){event.preventDefault()},dragOver:function(event){event.preventDefault()},drop:function(event){event.preventDefault();var photo_id=event.dataTransfer.getData("photo_id"),gallery_id=event.dataTransfer.getData("gallery_id");if("null"!=gallery_id){var data={photo_id:photo_id,gallery_id:gallery_id};this.get("controller").send("removePhotoFromGallery",data),App.Dropped=!0}else this.get("controller").send("removePhoto",photo_id);$(".removePhoto").slideUp()}}),App.EachAvailableView=Ember.View.extend({animateIn:function(done){this.$().fadeIn(done)},animateOut:function(done){this.$().fadeOut(done)}}),App.SharingPhotoView=Ember.View.extend({templateName:"sharing",mobile:function(){return $(window).width()<512?!0:!1}.property("controller.model"),url:function(){return encodeURIComponent(window.location.href)}.property("controller.currentPhoto.id"),thumb:function(){return encodeURIComponent("http://mgibsonphotoworks.com"+this.get("controller.currentPhoto.thumbFile"))}.property("controller.currentPhoto.thumbFile"),large:function(){return encodeURIComponent("http://mgibsonphotoworks.com"+this.get("controller.currentPhoto.largeFile"))}.property("controller.currentPhoto.largeFile"),title:function(){return encodeURIComponent(this.get("controller.currentPhoto.title"))}.property("controller.currentPhoto.title"),twitterURL:function(){var base="http://twitter.com/share?url=",url=this.get("url"),message=this.get("title"),handle=this.get("controller.site.twitter");return base+url+"&text="+message+"&via="+handle}.property("controller.currentPhoto","controller.site"),facebookURL:function(){var base="http://facebook.com/sharer.php?s=100&p[url]=",url=this.get("url"),thumb=this.get("thumb"),title=this.get("title"),summary=encodeURIComponent(this.get("controller.currentPhoto.caption")||"Photo from Mahonri Gibson Photographic Works");return base+url+"&p[images][0]="+thumb+"&p[title]="+title+"&p[summary]="+summary}.property("controller.currentPhoto"),tumblrURL:function(){var base="http://www.tumblr.com/share/link?url=",url=this.get("url"),title=this.get("title"),desc=encodeURIComponent(this.get("controller.currentPhoto.caption")||"Photo from Mahonri Gibson Photographic Works");return base+url+"&name="+title+"&description="+desc}.property("controller.currentPhoto"),gplusURL:function(){var base="https://plus.google.com/share?url=",url=this.get("url");return base+url}.property("controller.currentPhoto"),pinterestURL:function(){var base="https://pinterest.com/pin/create/bookmarklet/?media=",large=this.get("large"),url=this.get("url"),title=this.get("title");return base+large+"&url="+url+"&description="+title}.property("controller.currentPhoto"),emailURL:function(){var base="mailto:?subject=",subject=this.get("title"),body='Check this out: <a href="'+this.get("url")+'">'+subject+"</a>";return base+subject+"&body="+body}.property("controller.currentPhoto"),flattrURL:function(){var handle=this.get("controller.site.twitter"),base="https://flattr.com/submit/auto?user_id="+handle+"&url="+this.get("url");return base}.property("controller.currentPhoto"),click:function(event){event.preventDefault();var leftPosition,topPosition,$target=$(event.target),href=$target.attr("href"),width=.8*$(window).width(),height=.8*$(window).height();leftPosition=window.screen.width/2-(width/2+10),topPosition=window.screen.height/2-(height/2+50),window.open(href,"Window2","status=no,height="+height+",width="+width+",resizable=yes,left="+leftPosition+",top="+topPosition+",screenX="+leftPosition+",screenY="+topPosition+",toolbar=no,menubar=no,scrollbars=no,location=no,directories=no")}}),App.AdminView=Ember.View.extend({willAnimateIn:function(){this.$().hide()},animateIn:function(done){this.$().fadeIn(done)},animateOut:function(done){this.$().fadeOut(done)}});